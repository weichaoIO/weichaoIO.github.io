<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/my_icon.ico"><link rel="icon" href="/img/my_icon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="魏超"><meta name="keywords" content="魏超,weichao"><meta name="description" content="“GitLab用于集中解决项目继承、项目部署的难题，从而提高生产力，降低开发集成的风险。”"><meta property="og:type" content="article"><meta property="og:title" content="《GitLab CI&#x2F;CD从入门到实战》"><meta property="og:url" content="https://weichao.io/404278720fdb/index.html"><meta property="og:site_name" content="『魏超』的 blog"><meta property="og:description" content="“GitLab用于集中解决项目继承、项目部署的难题，从而提高生产力，降低开发集成的风险。”"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/1.png"><meta property="og:image" content="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/2.png"><meta property="og:image" content="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/3.png"><meta property="og:image" content="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/4.png"><meta property="og:image" content="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/5.png"><meta property="article:published_time" content="2024-01-28T04:38:14.000Z"><meta property="article:modified_time" content="2024-01-28T05:22:23.864Z"><meta property="article:author" content="魏超"><meta property="article:tag" content="读书笔记"><meta property="article:tag" content="《GitLab CI&#x2F;CD从入门到实战》"><meta property="article:tag" content="Docker"><meta property="article:tag" content="GitLab"><meta property="article:tag" content="GitLab CI&#x2F;CD"><meta property="article:tag" content=".gitlab-ci.yml"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/1.png"><title>《GitLab CI/CD从入门到实战》 - 『魏超』的 blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1956623_vyed6le6uz.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"weichao.io",root:"/",version:"1.9.4",typing:{enable:!1,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!1},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:2},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!0,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"kQcwfNV9f5OTEb51AgXNco4o-gzGzoHsz",app_key:"IVVmse4bqkjcVx2bEJiswbJc",server_url:"https://kqcwfnv9.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>『魏超』的 blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-my-home"></i> <span>首页</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-my-document"></i> <span>文档</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-my-archive"></i> <span>归档</span> </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-my-category"></i> <span>分类</span> </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-my-tag"></i> <span>标签</span></a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-my-image"></i> <span>图库</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/photo/"><i class="iconfont icon-my-camera"></i> <span>摄影</span> </a><a class="dropdown-item" href="/skiing/"><i class="iconfont icon-my-skiing"></i> <span>滑雪</span> </a><a class="dropdown-item" href="/motor/"><i class="iconfont icon-my-motor"></i> <span>摩托车</span></a></div></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-my-me"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-my-link"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/banner_book.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">《GitLab CI/CD从入门到实战》</span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> 魏超 </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-01-28 12:38" pubdate>2024年1月28日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 8.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 70 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="《GitLab CI/CD从入门到实战》" id="heading-d5a41a1324327745d6affa41d2fa775f" role="tab" data-toggle="collapse" href="#collapse-d5a41a1324327745d6affa41d2fa775f" aria-expanded="true">《GitLab CI/CD从入门到实战》 <span class="list-group-count">(1)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-d5a41a1324327745d6affa41d2fa775f" role="tabpanel" aria-labelledby="heading-d5a41a1324327745d6affa41d2fa775f"><div class="category-post-list"><a href="/404278720fdb/" title="《GitLab CI/CD从入门到实战》" class="list-group-item list-group-item-action active"><span class="category-post">《GitLab CI/CD从入门到实战》</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">《GitLab CI/CD从入门到实战》</h1><p class="note note-info">本文最后更新于：1 分钟前</p><div class="markdown-body"><h1 id="gitlab-cicd从入门到实战"><a class="markdownIt-Anchor" href="#gitlab-cicd从入门到实战"></a> 《GitLab CI/CD从入门到实战》</h1><p>勘误：<a target="_blank" rel="noopener" href="https://www.epubit.com/bookDetails?id=UBd184c0c65d05">https://www.epubit.com/bookDetails?id=UBd184c0c65d05</a>​</p><p>实践：<a href="https://weichao.io/6b7041ccc86d/">https://weichao.io/6b7041ccc86d/</a></p><h1 id="第1章认识gitlab-cicd"><a class="markdownIt-Anchor" href="#第1章认识gitlab-cicd"></a> <strong>第1章：认识Gitlab CI/CD</strong></h1><ul><li>CI：Continuous Integration，持续集成。<ul><li>集成：比如，将自己分支的代码合并到测试分支。自动构建应用并运行不同级别的自动化测试。</li></ul></li><li>CD：<ul><li>Continuous Delivery，持续交付。完成CI后，自动将已验证的代码发布到存储库，可随时手动部署到生产环境。</li><li>Continuous Deployment，持续部署。自动部署到开发环境、测试环境甚至生产环境。</li></ul></li></ul><p>GitLab CI/CD的组成：</p><ul><li>运行流水线的环境：由GitLab Runner提供。<ul><li>流水线pipeline：一系列的自动化作业，触发流水线的时机可以是代码推送、创建tag<code>tag流水线</code>​​、合并请求<code>合并请求流水线</code>​​、定时触发<code>定时流水线</code>​​等。还有跨项目流水线、父子流水线等。</li><li>stages：给作业分组，规定每个阶段stage的运行顺序。</li><li>作业job：最基础的执行单元。</li></ul></li><li>.gitlab-ci.yml文件：定义流水线内容。</li></ul><p>几点说明：</p><ul><li>stages可能有多个stage，stage可能有多个job。</li><li>job的执行顺序由stage定义。</li><li>同一个stage内的job是并行运行的。</li><li>如果job的名称以<code>.</code>​开头，说明该job是一个隐藏作业，任何时候都不会执行，可以作为注释或配置模板供别的job继承。</li></ul><p>GitLab Runner安装好之后，并不能被GitLab直接调用，还需要注册一个runner<code>负责执行流水线的内容，并与GitLab通信、上传执行结果与日志，在runner中指定的执行器才是流水线真正的运行环境</code>​，最后编写.gitlab-ci.yml文件。</p><h1 id="第2章cicd环境gitlab-runner"><a class="markdownIt-Anchor" href="#第2章cicd环境gitlab-runner"></a> <strong>第2章：CI/CD环境Gitlab Runner</strong></h1><h2 id="使用docker安装gitlab-runner"><a class="markdownIt-Anchor" href="#使用docker安装gitlab-runner"></a> 使用Docker安装<strong>Gitlab Runner</strong></h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd">sudo docker run -d --name gitlab-runner --restart always \<br>  -v gitlab-runner:/etc/gitlab-runner \<br>  -v /var/run/docker.sock:/var/run/docker.sock \<br>  gitlab/gitlab-runner:v16.<span class="hljs-number">8</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>宿主用的参数：</p><ul><li>–name gitlab-runner：设置Docker名字。</li><li>–restart always：在宿主重启后，Docker容器也会重启。</li><li>-v gitlab-runner:/etc/gitlab-runner：挂载目录。冒号前面的地址指向宿主地址，冒号后面的地址是Docker地址。</li><li>gitlab/gitlab-runner:v16.8.0：Docker镜像和版本，运行时先在本地搜索，如果没有，再从Docker Hub下载。</li></ul><h2 id="注册runner"><a class="markdownIt-Anchor" href="#注册runner"></a> <strong>注册runner</strong></h2><h3 id="已过时方法1使用registration-token"><a class="markdownIt-Anchor" href="#已过时方法1使用registration-token"></a> 【已过时】方法1：使用registration token</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd">docker run --rm -v gitlab-runner:/etc/gitlab-runner gitlab/gitlab-runner:v16.<span class="hljs-number">8</span>.<span class="hljs-number">0</span> register \<br>  --non-interactive \<br>  --executor &quot;docker&quot; \<br>  --docker-image mobiledevops/android-sdk-image:<span class="hljs-number">34</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>-jdk17 \<br>  --url &quot;http://<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">50</span>.<span class="hljs-number">124</span>:<span class="hljs-number">20080</span>/&quot; \<br>  --registration-token &quot;GR1348941e2aaEee8stBszk5iuLri&quot; \<br>  --description &quot;docker-runner&quot; \<br>  --run-untagged=&quot;true&quot; \<br>  --tag-list &quot;shared&quot; \<br>  --locked=&quot;false&quot; \<br>  --access-level=&quot;not_protected&quot;<br></code></pre></td></tr></table></figure><p>宿主用的参数：</p><ul><li>-v gitlab-runner:/etc/gitlab-runner：挂载目录。冒号前面的地址指向宿主地址，冒号后面的地址是Docker地址。</li><li>gitlab/gitlab-runner:v16.8.0：Docker镜像和版本，运行时先在本地搜索，如果没有，再从Docker Hub下载。</li></ul><p>Docker用的参数：</p><ul><li>–non-interactive：表示与其他runner不会相互影响。</li><li>–executor “docker”：指定执行器。</li><li>–docker-image mobiledevops/android-sdk-image:34.0.0-jdk17：如果指定执行器为Docker，就需要指定一个基础镜像。</li><li>–url “<a target="_blank" rel="noopener" href="http://192.168.50.124:20080/">http://192.168.50.124:20080/</a>”：指定GitLab的域名，将runner与GitLab关联。</li><li>–registration-token “GR1348941e2aaEee8stBszk5iuLri”：指定Token，在GitLab页面上获取。</li><li>–tag-list “shared”：指定runner的标签。</li></ul><h3 id="方法2使用token"><a class="markdownIt-Anchor" href="#方法2使用token"></a> 方法2：使用token</h3><p><a href="https://weichao.io/6b7041ccc86d/#%E6%B3%A8%E5%86%8C-runner%E9%80%9A%E8%BF%87-gitlab-%E7%94%9F%E6%88%90-token">注册 runner（通过 GitLab 生成 token）</a>​</p><h3 id="各种执行器特点的对比"><a class="markdownIt-Anchor" href="#各种执行器特点的对比"></a> 各种执行器特点的对比</h3><p><a target="_blank" rel="noopener" href="https://docs.gitlab.com/runner/executors/#selecting-the-executor">https://docs.gitlab.com/runner/executors/#selecting-the-executor</a>​</p><p>​<img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/1.png" srcset="/img/loading.gif" lazyload alt="">​</p><p>‍</p><h3 id="各种执行器在执行流水线时的差异"><a class="markdownIt-Anchor" href="#各种执行器在执行流水线时的差异"></a> 各种执行器在执行流水线时的差异</h3><p><a target="_blank" rel="noopener" href="https://docs.gitlab.com/runner/executors/#compatibility-chart">https://docs.gitlab.com/runner/executors/#compatibility-chart</a>​</p><p>​<img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/2.png" srcset="/img/loading.gif" lazyload alt="">​</p><p>​<img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/3.png" srcset="/img/loading.gif" lazyload alt="">​</p><h2 id="配置runner"><a class="markdownIt-Anchor" href="#配置runner"></a> 配置runner</h2><p>gitlab-runner/_data/config.toml</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cmd">concurrent = <span class="hljs-number">1</span><br>check_interval = <span class="hljs-number">0</span><br>shutdown_timeout = <span class="hljs-number">0</span><br><br>[session_server]<br>  session_timeout = <span class="hljs-number">1800</span><br><br>[[runners]]<br>  name = &quot;docker-runner&quot;<br>  url = &quot;http://<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">50</span>.<span class="hljs-number">124</span>:<span class="hljs-number">20080</span>/&quot;<br>  id = <span class="hljs-number">5</span><br>  token = &quot;glrt-dNcto3isyApqxZqWxzUC&quot;<br>  token_obtained_at = <span class="hljs-number">2024</span>-<span class="hljs-number">01</span>-<span class="hljs-number">23</span>T08:<span class="hljs-number">24</span>:<span class="hljs-number">29</span>Z<br>  token_expires_at = <span class="hljs-number">0001</span>-<span class="hljs-number">01</span>-<span class="hljs-number">01</span>T00:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z<br>  executor = &quot;docker&quot;<br>  [runners.cache]<br>    MaxUploadedArchiveSize = <span class="hljs-number">0</span><br>  [runners.docker]<br>    tls_verify = false<br>    image = &quot;mobiledevops/android-sdk-image:<span class="hljs-number">34</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>-jdk17&quot;<br>    privileged = false<br>    disable_entrypoint_overwrite = false<br>    oom_kill_disable = false<br>    disable_cache = false<br>    volumes = [&quot;/cache&quot;]<br>    shm_size = <span class="hljs-number">0</span><br>    network_mtu = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><ul><li>concurrent：限制runner能够同时执行多少个作业</li><li>check_interval：检查新任务的间隔，以秒为单位。</li><li>volumes：挂载主机哪些目录到容器中。</li></ul><h2 id="runner的工作流程"><a class="markdownIt-Anchor" href="#runner的工作流程"></a> <strong>runner的工作流程</strong></h2><p>【已过时】<a target="_blank" rel="noopener" href="https://docs.gitlab.com/runner/#runner-execution-flow">https://docs.gitlab.com/runner/#runner-execution-flow</a></p><p>​<img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/4.png" srcset="/img/loading.gif" lazyload alt="">​</p><h1 id="第3章流水线内容gitlab-ciyml"><a class="markdownIt-Anchor" href="#第3章流水线内容gitlab-ciyml"></a> 第3章：<strong>流水线内容.gitlab-ci.yml</strong></h1><h2 id="存放位置"><a class="markdownIt-Anchor" href="#存放位置"></a> <strong>存放位置</strong></h2><p>​<img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/5.png" srcset="/img/loading.gif" lazyload alt="">​</p><h2 id="流水线的结构"><a class="markdownIt-Anchor" href="#流水线的结构"></a> <strong>流水线的结构</strong></h2><p>YAML文件的基本语法特点：</p><ul><li>大小写敏感。</li><li>使用缩进表示层级关系。<ul><li>缩进不支持使用TAB键，只支持空格键。</li><li>缩进的空格数不重要，只要相同层级的元素左对齐即可。</li></ul></li><li>用#表示注释。</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">image:</span> <span class="hljs-string">mobiledevops/android-sdk-image:34.0.0-jdk17</span><br><span class="hljs-attr">stages:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">build</span><br><br><span class="hljs-attr">release_build:</span><br>    <span class="hljs-attr">stage:</span> <span class="hljs-string">build</span><br>    <span class="hljs-attr">tags:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">shared</span><br>    <span class="hljs-attr">script:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">clean</span> <span class="hljs-string">assembleRelease</span><br></code></pre></td></tr></table></figure><h1 id="第4章初阶关键词"><a class="markdownIt-Anchor" href="#第4章初阶关键词"></a> 第4章：初阶<strong>关键词</strong></h1><table><thead><tr><th>全局关键词</th><th>关键词</th><th>例</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>stages</td><td></td><td>stages:<br>- .pre<br>- build<br>- test<br>- deploy<br>- .post</td><td>.pre<br>build<br>test<br>deploy<br>.post</td><td>当前流水线包含哪些阶段stage。<br>可以自定义stage。<br></td></tr><tr><td>作业</td><td>stage</td><td>stage: test</td><td>test</td><td>当前作业的阶段。<br>取值是stages中的某个元素。</td></tr><tr><td>作业<br></td><td>script<br></td><td>script: npm install</td><td></td><td>当前作业要执行的脚本。<br>在项目的根目录下执行。<br><br>例：<code>script: npm install</code>​<br>如果GitLab Runner是直接在宿主机上安装的，而不是使用Docker，那么在执行之前需要在宿主机上安装Node.js。<br>如果执行器是Docker，就需要在这个作业上指定node镜像。<br></td></tr><tr><td></td><td></td><td>script:<br>- npm install<br>- npm build</td><td></td><td></td></tr><tr><td>default</td><td></td><td></td><td></td><td>全局配置，对整个流水线设置。<br>default定义的属性只有在作业没有定义时才会生效。</td></tr><tr><td>作业/default</td><td>cache</td><td></td><td></td><td>可以将不同作业中共用的文件或者文件夹缓存起来<code>每个作业都是独立运行的，如果没有缓存，运行上一个作业时安装的项目依赖包，在运行下一个作业时还需要安装一次</code>​，要缓存的文件路径必须是当前工作目录的相对路径。<br><br>如果执行器是Shell，缓存文件存放在/home/gitlab-runner/cache/<user>/<project>/<cache-key>/cache.zip。<br>如果执行器是Shell，缓存文件存放在/var/lib/docker/volumes/<volume-id>/_data/<user>/<project>/<cache-key>/cache.zip。<br><br>如果一个项目中的两条流水线命中了同一个key的缓存，那么不管这个缓存是不是在当前流水线中创建的，都可以被使用。<br></cache-key></project></user></volume-id></cache-key></project></user></td></tr><tr><td>作业/default</td><td>cache/key</td><td>cache:<br>key: “$KEY”</td><td>default</td><td>通过key确定文件。<br>一个作业中最多可以定义4个key。<br></td></tr><tr><td>作业/default</td><td>cache/key/files</td><td>cache:<br>key:<br>files:<br>- yarn.lock</td><td></td><td>将key指向一个文件列表，只要文件内容没有变动，key就不会变。</td></tr><tr><td>作业/default</td><td>cache/paths</td><td>cache:<br>paths:<br>- node_modules<br>- binaries/*.apk<br>- .config</td><td></td><td>要缓存的文件路径。</td></tr><tr><td>作业/default</td><td>image</td><td>image: node:12.21.0</td><td></td><td>指定一个Docker镜像作为基础镜像来执行当前的作业。<br>如果执行器不是Docker，该设置无效。<br><br>如果作业需要多个镜像处理，要么拆分作业，要么重新制作一个合并的镜像。<br></td></tr><tr><td>作业/default</td><td>tags</td><td>tags:<br>- docker-runner</td><td></td><td>指定执行当前作业的runner。</td></tr><tr><td>作业<br></td><td>variables<br></td><td>variables:<br>USER_NAME: ‘fizz’<br></td><td></td><td>定义一些变量，默认是环境变量。<br></td></tr><tr><td></td><td></td><td>variables:<br>- USER_NAME: “fizz”</td><td></td><td></td></tr><tr><td>variables</td><td></td><td><br><br></td><td></td><td>全局变量。<br><br>对于隐私的变量，在GitLab页面上设置，手动执行流水线时也可以定义变量。<br><br>有一些预设变量。</td></tr><tr><td>作业</td><td>when</td><td>when: manual</td><td>on_success</td><td>如果作业失败或成功，可以执行一些额外的逻辑。<br>如果值为never，表示不执行。</td></tr><tr><td>作业/default</td><td>artifacts</td><td></td><td></td><td>将构建出的文件保存起来，可以在下一个阶段的作业中被自动恢复到工作目录。</td></tr><tr><td>作业/default</td><td>artifacts/exclude</td><td>artifacts:<br>paths:<br>- /dist<br>- *.jar<br>exclude:<br>- *.o<br>expire_in: 1 week<br>name: “$NAME”</td><td></td><td>排除文件或文件夹。</td></tr><tr><td>作业/default</td><td>artifacts/expire_in</td><td></td><td></td><td>有效期。</td></tr><tr><td>作业/default</td><td>artifacts/name</td><td></td><td></td><td>名称。</td></tr><tr><td>作业/default</td><td>artifacts/paths</td><td></td><td></td><td>要存储的文件或文件夹。</td></tr><tr><td>作业/default</td><td>artifacts/expose_as</td><td></td><td></td><td>在GitLab页面上显示的名称。</td></tr><tr><td>作业/default</td><td>artifacts/public</td><td></td><td></td><td>是否公开。</td></tr><tr><td>作业/default</td><td>before_script</td><td><br></td><td></td><td>定义作业需要执行的脚本、命令行。<br>执行时机是在script之前、在artifacts之后。</td></tr><tr><td>作业/default</td><td>after_script</td><td><br></td><td></td><td>定义一组在作业执行结束后执行的脚本。<br>是在单独的Shell环境中执行的。</td></tr><tr><td>作业</td><td>only</td><td>only:<br>- test</td><td></td><td>设置当前作业的执行时机。<br>当条件满足时执行作业。</td></tr><tr><td>作业</td><td>except</td><td><br></td><td></td><td>设置当前作业的执行时机。<br>当条件满足时不执行作业。</td></tr><tr><td>作业</td><td>only/refs</td><td>only:<br>refs:<br>- test<br></td><td></td><td>只有在某个分支或某个流水线类型下才会执行作业。</td></tr><tr><td>作业</td><td>except/refs</td><td><br></td><td></td><td>只有在某个分支或某个流水线类型下才会不执行作业。</td></tr><tr><td>作业</td><td>only/variables</td><td>only:<br>variables:<br>- $USER_NAME === “fizz”</td><td></td><td>根据变量的值动态地决定是否执行作业。</td></tr><tr><td>作业</td><td>except/variables<br></td><td><br></td><td></td><td>根据变量的值动态地决定是否不执行作业。</td></tr><tr><td>作业</td><td>only/changes</td><td>only:<br>changes:<br>- Dockerfile</td><td></td><td>当指定的文件改变时执行作业。</td></tr><tr><td>作业</td><td>except/changes</td><td><br></td><td></td><td>当指定的文件改变时不执行作业。</td></tr><tr><td>作业</td><td>only/kubernetes</td><td>only:<br>kubernetes: active</td><td></td><td>如果接入了kubernetes就执行作业。</td></tr><tr><td>作业</td><td>except/kubernetes</td><td><br></td><td></td><td>如果接入了kubernetes就不执行作业。</td></tr></tbody></table><h1 id="第5章中阶关键词"><a class="markdownIt-Anchor" href="#第5章中阶关键词"></a> <strong>第5章：中阶关键词</strong></h1><table><thead><tr><th>全局关键词</th><th>关键词</th><th>例</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>作业</td><td>coverage</td><td>coverage: '/Code coverage: \d+\.\d+/'</td><td></td><td>配置一个正则表达式，可以提取出作业日志中输出的代码覆盖率。</td></tr><tr><td>作业</td><td>dependencies</td><td>dependencies:<br>- build_mac</td><td>默认所有artifacts在下一阶段都会被下载。</td><td>定义当前作业下载哪些前置作业的artifacts，也可以不下载。</td></tr><tr><td>作业</td><td>allow_failure</td><td>allow_failure: true</td><td>false，手动触发作业时是true。</td><td>设置当前作业失败时流水线是否继续运行。</td></tr><tr><td>作业</td><td>extends</td><td>extends: .test</td><td></td><td>继承配置模板。</td></tr><tr><td>作业/default</td><td>timeout</td><td>timeout: 1h</td><td></td><td>设置一个作业的超时时间。</td></tr><tr><td>作业</td><td>inherit</td><td></td><td></td><td>限制作业是否使用default或variables定义的配置。</td></tr><tr><td>作业<br></td><td>inherit/default<br></td><td>inherit:<br>default: false<br></td><td></td><td>false表示不使用default中的全部值，数组表示使用的default中的值。<br></td></tr><tr><td></td><td></td><td>inherit:<br>default:<br>- retry<br>- image</td><td></td><td></td></tr><tr><td>作业<br></td><td>inherit/variables<br></td><td>inherit:<br>variables: false</td><td></td><td>false表示不使用variables中的全部值，数组表示使用的variables中的值。<br></td></tr><tr><td></td><td></td><td>inherit:<br>variables:<br>- NAME<br>- AGE</td><td></td><td></td></tr><tr><td>作业/default</td><td>interruptible</td><td>interruptible: true</td><td>false</td><td>设置旧的流水线能否被新的流水线取消。<br>如果旧的流水线已经运行到了build_job，就不会被取消了。</td></tr><tr><td>作业<br></td><td>needs<br></td><td>needs: [“install_java”]</td><td></td><td>设置只要当前作业所依赖的作业已完成，就会执行当前作业。<br>可以跨流水线。<br></td></tr><tr><td></td><td></td><td>needs:<br>- pipeline: $PARENT_PIPELINE_ID<br>- job: create-artifact</td><td></td><td></td></tr><tr><td>pages</td><td></td><td></td><td></td><td>将作业artifacts发布到GitLab Pages。</td></tr><tr><td>作业</td><td>parallel</td><td>parallel: 5</td><td><br></td><td>设置一个作业同时运行多少次，取值范围是2~50。</td></tr><tr><td>作业</td><td>parallel/matrix</td><td>parallel:<br>matrix:<br>- PROVIDER: aws<br>STACK:<br>- monitoring<br>- app1<br>- app2</td><td></td><td>为同时运行的作业注入不同的变量值。</td></tr><tr><td>作业/default</td><td>retry</td><td>retry: 2</td><td>0</td><td>设置作业在运行失败时的重试次数，取值范围是0、1、2。</td></tr><tr><td>作业/default</td><td>retry/when</td><td>retry:<br>max: 2<br>when: runner_system_failure</td><td></td><td>当特定错误出现时进行重试。</td></tr><tr><td>作业</td><td>release</td><td>release:<br>name: ‘Release $TAG’<br>description: ‘Release created using the release-cli’</td><td></td><td>创建发布。</td></tr></tbody></table><h1 id="第6章高阶关键词"><a class="markdownIt-Anchor" href="#第6章高阶关键词"></a> <strong>第6章：高阶关键词</strong></h1><table><thead><tr><th>全局关键词</th><th>关键词</th><th>值的类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>作业</td><td>rules</td><td></td><td></td><td>only/except的加强版，推荐使用rules。</td></tr><tr><td>作业</td><td>rules/if</td><td>rules:<br>- if: ‘$NAME =~ /^feature/’</td><td></td><td>条件判断，当结果为true时执行作业。</td></tr><tr><td>作业</td><td>rules/changes</td><td>rules:<br>- changes:<br>- Dockerfile</td><td></td><td>当指定的文件改变时执行作业。</td></tr><tr><td>作业</td><td>rules/exists</td><td>rules:<br>- exists:<br>- Dockerfile</td><td></td><td>当指定的文件存在时执行作业。</td></tr><tr><td>作业</td><td>rules/allow_falure</td><td>rules:<br>- if: ‘$NAME =~ /^feature/’<br>allow_falure: true</td><td>false</td><td>设置当前作业失败时流水线是否继续运行。</td></tr><tr><td>作业</td><td>rules/variables</td><td>rules:<br>- if: ‘$NAME =~ /^feature/’<br>variables:<br>DEPLOY_VARIABLE: “deploy-production”</td><td></td><td>根据变量的值动态地决定是否执行作业。</td></tr><tr><td>workflow</td><td></td><td></td><td></td><td>配置多个规则来限定流水线是否运行。</td></tr><tr><td>workflow/rules</td><td></td><td></td><td></td><td>这里定义的rules是直接作用于流水线的。</td></tr><tr><td></td><td>trigger</td><td>trigger:<br>project: my/deployment<br>branch: stable-2022</td><td></td><td>在流水线中再触发新的流水线。</td></tr><tr><td></td><td>trigger/strategy</td><td>trigger:<br>include: a.yml<br>strategy: depend</td><td></td><td>当值为depend表示等下游流水线完成后，再继续运行当前流水线。</td></tr><tr><td></td><td>include</td><td><br></td><td></td><td>引入模板。</td></tr><tr><td></td><td>include/local<br></td><td>include:<br>- local: ‘a.yml’</td><td></td><td>引入本地文件。</td></tr><tr><td></td><td>include/file</td><td>include:<br>- project: 'my/deployment'<br>ref: main<br>file: 'a.yml'</td><td></td><td>引入其他项目的文件。</td></tr><tr><td></td><td>include/remote</td><td>include:<br>- remote: ‘a.yml’</td><td></td><td>引入公网文件。</td></tr><tr><td></td><td>include/template</td><td>include:<br>- template: Android-Fastlane.gitlab-ci.yml</td><td></td><td>引入官方模板文件。</td></tr><tr><td></td><td>resource_group</td><td>resource_group: prod</td><td></td><td>在同一时间只会有一个作业运行。</td></tr><tr><td></td><td>environment</td><td>environment: test</td><td></td><td>部署作业的环境名称。</td></tr><tr><td></td><td>environment/name</td><td>environment:<br>name: test</td><td></td><td>部署环境的名称。</td></tr><tr><td></td><td>environment/url</td><td>environment:<br>url:</td><td></td><td>部署环境的访问地址。</td></tr><tr><td></td><td>environment/on_stop</td><td>environment:<br>on_stop: clean_test_env</td><td></td><td>在移除环境时触发一个清空部署环境的作业。</td></tr><tr><td></td><td>environment/action</td><td>environment:<br>action: stop</td><td>start</td><td>stop表示该作业可以配置到environment/on_stop上。</td></tr><tr><td></td><td>environment/auto_stop_in</td><td>environment:<br>auto_stop_in: 1 day</td><td></td><td>部署环境存留的时间。</td></tr><tr><td>作业/default</td><td>services</td><td>services:<br>- mysql<br>- postgres: 11.7</td><td></td><td>在作业上添加除image之外的Docker镜像，这些镜像可以与image通信。</td></tr><tr><td></td><td>secrets</td><td><br></td><td></td><td>密钥。</td></tr><tr><td></td><td>dast_configuration</td><td><br></td><td></td><td>扫描部署后的网站，检查错误配置和安全隐患。</td></tr></tbody></table><h1 id="第7章gitlab-cicd部署前端项目"><a class="markdownIt-Anchor" href="#第7章gitlab-cicd部署前端项目"></a> <strong>第7章：GitLab CI/CD部署前端项目</strong></h1><h1 id="第8章java复杂微服务应用的cicd方案"><a class="markdownIt-Anchor" href="#第8章java复杂微服务应用的cicd方案"></a> <strong>第8章：Java复杂微服务应用的CI/CD方案</strong></h1><h1 id="第9章部署python应用到kubernetes中"><a class="markdownIt-Anchor" href="#第9章部署python应用到kubernetes中"></a> <strong>第9章：部署Python应用到Kubernetes中</strong></h1></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/" class="category-chain-item">《GitLab CI/CD从入门到实战》</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">#读书笔记</a> <a href="/tags/%E3%80%8AGitLab-CI-CD%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%E3%80%8B/">#《GitLab CI/CD从入门到实战》</a> <a href="/tags/Docker/">#Docker</a> <a href="/tags/GitLab/">#GitLab</a> <a href="/tags/GitLab-CI-CD/">#GitLab CI/CD</a> <a href="/tags/gitlab-ci-yml/">#.gitlab-ci.yml</a></div></div><div class="license-box my-3"><div class="license-title"><div>《GitLab CI/CD从入门到实战》</div><div>https://weichao.io/404278720fdb/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>魏超</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2024年1月28日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年1月28日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/6b7041ccc86d/" title="威联通 NAS 安装 GitLab + GitLab Runner 实现自动打包生成 apk 文件"><span class="hidden-mobile">威联通 NAS 安装 GitLab + GitLab Runner 实现自动打包生成 apk 文件</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><i class="iconfont icon-my-hexo"></i>&nbsp;<span>博客框架Hexo&nbsp;&nbsp;</span></a> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><i class="iconfont icon-my-theme"></i>&nbsp;<span>博客主题Fluid&nbsp;&nbsp;</span></a> <a href="https://weichao.io" target="_blank" rel="nofollow noopener"><i class="iconfont icon-my-copyright"></i>&nbsp;2023<span>魏超</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>